<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explore English</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .input-section {
            margin-bottom: 30px;
        }

        .input-section label {
            display: block;
            font-size: 1.1em;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        textarea {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        button {
            flex: 1;
            padding: 12px 24px;
            font-size: 1em;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 120px;
        }

        .analyze-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .analyze-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .analyze-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .clear-btn {
            background: #f5f5f5;
            color: #333;
        }

        .clear-btn:hover {
            background: #e0e0e0;
        }

        .export-btn {
            background: #4CAF50;
            color: white;
        }

        .export-btn:hover {
            background: #45a049;
        }

        .import-btn {
            background: #FF9800;
            color: white;
        }

        .import-btn:hover {
            background: #F57C00;
        }

        .results {
            margin-top: 30px;
        }

        .result-text {
            line-height: 1.8;
            font-size: 1.1em;
            color: #333;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .found-word {
            background-color: #2196F3;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-block;
        }

        .found-word:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.4);
        }

        .not-found-word {
            background-color: #f44336;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-block;
        }

        .not-found-word:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(244, 67, 54, 0.4);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }

        .modal.show {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            animation: slideUp 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            font-size: 1.5em;
            font-weight: 700;
            margin-bottom: 20px;
            color: #333;
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #555;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 1em;
            font-family: inherit;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #2196F3;
        }

        .modal-footer {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            flex-wrap: wrap;
        }

        .btn-primary {
            background: #2196F3;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95em;
        }

        .btn-primary:hover {
            background: #1976D2;
        }

        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .btn-danger {
            background: #f44336;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95em;
        }

        .btn-danger:hover {
            background: #d32f2f;
        }

        .btn-secondary {
            background: #f5f5f5;
            color: #333;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95em;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .btn-auto {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95em;
        }

        .btn-auto:hover {
            background: #45a049;
        }

        .btn-auto:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
            font-size: 1.1em;
        }

        .ai-loading {
            text-align: center;
            padding: 15px;
            margin-bottom: 15px;
            background: #e8f5e9;
            border-radius: 8px;
            color: #2e7d32;
            font-size: 0.95em;
            font-weight: 500;
        }

        .ai-error {
            background: #ffebee;
            color: #c62828;
        }

        .footer {
            background: #f5f5f5;
            padding: 15px;
            text-align: center;
            color: #666;
            font-size: 0.9em;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            padding: 20px;
            background: #f0f4ff;
            border-radius: 8px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 2em;
            font-weight: 700;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            margin-top: 5px;
        }

        .legend {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 15px;
            padding: 15px;
            background: #fff;
            border-radius: 8px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .legend-blue {
            background-color: #2196F3;
        }

        .legend-red {
            background-color: #f44336;
        }

        .meaning-display {
            background: #f0f4ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            line-height: 1.6;
            white-space: pre-wrap;
        }

        .info-banner {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            font-size: 0.95em;
            color: #1565C0;
        }

        input[type="file"] {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Explore English</h1>
            <p>AI-Powered Dictionary with Local Storage</p>
        </div>

        <div class="content">
            <div class="info-banner">
                üìö Dictionary ‡∂ë‡∂ö browser memory ‡∂ë‡∂ö‡∑ö save ‡∑Ä‡∑ô‡∂±‡∑Ä‡∑è. Export ‡∂ö‡∂ª‡∂Ω‡∑è backup ‡∂ë‡∂ö‡∂ö‡∑ä save ‡∂ö‡∂ª‡∂ú‡∂±‡∑ä‡∂±!
            </div>

            <div class="input-section">
                <label for="textInput">Enter your text (English):</label>
                <textarea id="textInput" placeholder="Paste or type your paragraph here...">We learn history referring to books written in ancient times; if not, with the help of the remaining articles used by the people who lived in the past. In addition to these two ways, we can learn about history through stories about the past narrated by our elders. There is a common term used to introduce everything which helps us to study history; that is 'a source'.</textarea>
                <div class="button-group">
                    <button class="analyze-btn" onclick="analyzeText()">Analyze Text</button>
                    <button class="clear-btn" onclick="clearAll()">Clear</button>
                    <button class="export-btn" onclick="exportDictionary()">üì• Export</button>
                    <button class="import-btn" onclick="document.getElementById('fileInput').click()">üì§ Import</button>
                </div>
                <input type="file" id="fileInput" accept=".json" onchange="importDictionary(event)">
            </div>

            <div id="loading" class="loading" style="display: none;">
                Analyzing text...
            </div>

            <div id="results" class="results" style="display: none;">
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color legend-blue"></div>
                        <span>Found in Dictionary</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color legend-red"></div>
                        <span>Not in Dictionary</span>
                    </div>
                </div>
                <h3 style="margin-top: 20px;">Analyzed Text:</h3>
                <div id="resultText" class="result-text"></div>
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-number" id="totalWords">0</div>
                        <div class="stat-label">Total Words</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="foundWords">0</div>
                        <div class="stat-label">Found in Dictionary</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="notFoundWords">0</div>
                        <div class="stat-label">Not Found</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="dictionarySize">0</div>
                        <div class="stat-label">Dictionary Size</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            ¬© Amila Udawatta - Explore English (AI-Powered)
        </div>
    </div>

    <!-- Edit Meaning Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Edit Meaning</div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Word:</label>
                    <input type="text" id="editWord" readonly style="background: #f5f5f5;">
                </div>
                <div class="meaning-display" id="currentMeaning"></div>
                <div class="form-group">
                    <label>New Meaning:</label>
                    <textarea id="editMeaning"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeEditModal()">Cancel</button>
                <button class="btn-danger" onclick="deleteWord()">Delete</button>
                <button class="btn-primary" onclick="saveMeaning()">Save</button>
            </div>
        </div>
    </div>

    <!-- Add to Dictionary Modal -->
    <div id="addModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Add to Dictionary</div>
            <div id="aiLoading" class="ai-loading" style="display: none;">
                ü§ñ AI is finding the meaning...
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Word:</label>
                    <input type="text" id="addWord" readonly style="background: #f5f5f5;">
                </div>
                <div class="form-group">
                    <label>Meaning:</label>
                    <textarea id="addMeaning" placeholder="Enter the meaning or click 'Find Meaning' to auto-fill..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeAddModal()">Cancel</button>
                <button class="btn-auto" id="findMeaningBtn" onclick="findMeaningWithAI()">üîç Find Meaning</button>
                <button class="btn-primary" onclick="addToDictionary()">Add to Dictionary</button>
            </div>
        </div>
    </div>

    <script>
        // In-memory dictionary storage
        let dictionaryData = {};
        let currentEditWord = null;

        // Load dictionary from memory on page load
        function loadDictionary() {
            const saved = localStorage.getItem('englishDictionary');
            if (saved) {
                try {
                    dictionaryData = JSON.parse(saved);
                    console.log('Dictionary loaded:', Object.keys(dictionaryData).length, 'words');
                } catch (e) {
                    console.error('Error loading dictionary:', e);
                    dictionaryData = {};
                }
            }
        }

        // Save dictionary to memory
        function saveDictionaryToStorage() {
            try {
                localStorage.setItem('englishDictionary', JSON.stringify(dictionaryData));
                return true;
            } catch (e) {
                console.error('Error saving dictionary:', e);
                return false;
            }
        }

        // Initialize dictionary on load
        loadDictionary();

        async function analyzeText() {
            const textInput = document.getElementById('textInput').value.trim();
            if (!textInput) {
                alert('‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª text ‡∂ë‡∂ö‡∂ö‡∑ä ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±!');
                return;
            }

            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').style.display = 'none';
            document.querySelector('.analyze-btn').disabled = true;

            // Small delay for UI feedback
            await new Promise(resolve => setTimeout(resolve, 300));

            const words = textInput.match(/\b[a-zA-Z]+\b/g) || [];
            const uniqueWords = new Set(words.map(w => w.toLowerCase()));
            let foundCount = 0;
            let notFoundCount = 0;

            const highlightedText = textInput.replace(/\b[a-zA-Z]+\b/g, (word) => {
                const lowerWord = word.toLowerCase();
                if (dictionaryData[lowerWord]) {
                    foundCount++;
                    return `<span class="found-word" onclick="showEditModal('${lowerWord}')">${word}</span>`;
                } else {
                    notFoundCount++;
                    return `<span class="not-found-word" onclick="showAddModal('${lowerWord}')">${word}</span>`;
                }
            });

            document.getElementById('resultText').innerHTML = highlightedText;
            document.getElementById('totalWords').textContent = uniqueWords.size;
            document.getElementById('foundWords').textContent = foundCount;
            document.getElementById('notFoundWords').textContent = notFoundCount;
            document.getElementById('dictionarySize').textContent = Object.keys(dictionaryData).length;

            document.getElementById('loading').style.display = 'none';
            document.getElementById('results').style.display = 'block';
            document.querySelector('.analyze-btn').disabled = false;
        }

        function showEditModal(word) {
            const wordData = dictionaryData[word.toLowerCase()];
            if (!wordData) return;
            
            currentEditWord = word.toLowerCase();
            
            document.getElementById('editWord').value = word;
            document.getElementById('currentMeaning').textContent = wordData;
            document.getElementById('editMeaning').value = wordData;
            document.getElementById('editModal').classList.add('show');
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.remove('show');
            currentEditWord = null;
        }

        function saveMeaning() {
            const meaning = document.getElementById('editMeaning').value.trim();
            if (!meaning) {
                alert('‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª meaning ‡∂ë‡∂ö‡∂ö‡∑ä ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±!');
                return;
            }

            dictionaryData[currentEditWord] = meaning;
            saveDictionaryToStorage();

            alert('Meaning updated successfully!');
            closeEditModal();
            analyzeText();
        }

        function deleteWord() {
            if (!confirm('Are you sure you want to delete this word from the dictionary?')) {
                return;
            }

            delete dictionaryData[currentEditWord];
            saveDictionaryToStorage();

            alert('Word deleted successfully!');
            closeEditModal();
            analyzeText();
        }

        function showAddModal(word) {
            document.getElementById('addWord').value = word;
            document.getElementById('addMeaning').value = '';
            document.getElementById('aiLoading').style.display = 'none';
            document.getElementById('findMeaningBtn').disabled = false;
            document.getElementById('addModal').classList.add('show');
        }

        function closeAddModal() {
            document.getElementById('addModal').classList.remove('show');
        }

        async function findMeaningWithAI() {
            const word = document.getElementById('addWord').value.trim();
            const aiLoadingDiv = document.getElementById('aiLoading');
            const findBtn = document.getElementById('findMeaningBtn');
            
            aiLoadingDiv.style.display = 'block';
            aiLoadingDiv.className = 'ai-loading';
            aiLoadingDiv.textContent = 'ü§ñ AI is finding the meaning...';
            findBtn.disabled = true;

            try {
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 1000,
                        messages: [
                            {
                                role: 'user',
                                content: `Provide a clear, concise dictionary definition for the English word "${word}". Include:
1. Part of speech (noun, verb, adjective, etc.)
2. Simple definition (1-2 sentences)
3. One example sentence

Format it naturally as a dictionary entry. Keep it brief and educational.`
                            }
                        ]
                    })
                });

                if (!response.ok) {
                    throw new Error('Failed to fetch meaning from AI');
                }

                const data = await response.json();
                const meaning = data.content
                    .filter(item => item.type === 'text')
                    .map(item => item.text)
                    .join('\n');

                document.getElementById('addMeaning').value = meaning;
                aiLoadingDiv.className = 'ai-loading';
                aiLoadingDiv.textContent = '‚úÖ Meaning found successfully!';
                
                setTimeout(() => {
                    aiLoadingDiv.style.display = 'none';
                }, 2000);

            } catch (error) {
                console.error('Error fetching meaning:', error);
                aiLoadingDiv.className = 'ai-loading ai-error';
                aiLoadingDiv.textContent = '‚ùå Error fetching meaning. Please enter manually.';
                
                setTimeout(() => {
                    aiLoadingDiv.style.display = 'none';
                }, 4000);
            } finally {
                findBtn.disabled = false;
            }
        }

        function addToDictionary() {
            const word = document.getElementById('addWord').value.trim().toLowerCase();
            const meaning = document.getElementById('addMeaning').value.trim();

            if (!meaning) {
                alert('‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª meaning ‡∂ë‡∂ö‡∂ö‡∑ä ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂± ‡∑Ñ‡∑ù "Find Meaning" click ‡∂ö‡∂ª‡∂±‡∑ä‡∂±!');
                return;
            }

            dictionaryData[word] = meaning;
            saveDictionaryToStorage();

            alert('Word added to dictionary successfully!');
            closeAddModal();
            analyzeText();
        }

        function exportDictionary() {
            const dataStr = JSON.stringify(dictionaryData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `english-dictionary-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            alert('Dictionary exported successfully!');
        }

        function importDictionary(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    if (confirm(`Import ${Object.keys(imported).length} words? This will merge with existing dictionary.`)) {
                        dictionaryData = { ...dictionaryData, ...imported };
                        saveDictionaryToStorage();
                        alert('Dictionary imported successfully!');
                        analyzeText();
                    }
                } catch (error) {
                    alert('Error importing dictionary. Please check the file format.');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        function clearAll() {
            document.getElementById('textInput').value = '';
            document.getElementById('results').style.display = 'none';
        }

        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('show');
            }
        }

        // Show dictionary size on load
        if (Object.keys(dictionaryData).length > 0) {
            console.log(`üìö Dictionary loaded with ${Object.keys(dictionaryData).length} words`);
        }
    </script>
</body>
</html>
